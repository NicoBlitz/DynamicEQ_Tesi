% fig16_headphone_target_resp.m
% Headphone magnitude frequency response target curves
% This function produces a figure used in V. Valimaki and J. D. Reiss, 
% "All About Audio Equalization: Solutions and Frontiers", 
% Applied Sciences, 2016.
%
% Written by Juho Liski, 15 March 2016
% Modified by Vesa Valimaki, 29 April 2016

freqPoints1 = [20 23 25 28 30 33 35 38 40 43 45 48 50 53 55 58 60 63 65 68 70 73 75 78 80 83 85 88 90 93 95 98 100 130 150 180 200 230 250 280 300 330 350 380 400 430 450 480 500 530 550 580 600 630 650 680 700 730 750 780 800 830 850 880 900 930 950 980 1000 1300 1500 1800 2000 2300 2500 2800 3000 3300 3500 3800 4000 4300 4500 4800 5000 5300 5500 5800 6000 6300 6500 6800 7000 7300 7500 7800 8000 8300 8500 8800 9000 9300 9500 9800 10000 12000 15000 18000 20000];
freqPoints2 = [20 23 25 28 30 33 35 38 40 43 45 48 50 53 55 58 60 63 65 68 70 73 75 78 80 83 85 88 90 93 95 98 100 130 150 180 200 230 250 280 300 330 350 380 400 430 450 480 500 530 550 580 600 630 650 680 700 730 750 780 800 830 850 880 900 930 950 980 1000 1300 1500 1800 2000 2300 2500 2800 3000 3300 3500 3800 4000 4300 4500 4800 5000 5300 5500 5800 6000 6300 6500 6800 7000 7300 7500 7800 8000 8300 8500 8800 9000 9300 9500 9800 10000 11000 12000 13000 14000 15000 16000 17000 18000 19000 20000];
freqAxis    = zeros(512,1); f_temp = 20000/20;
freqAxis(1) = 20;
for k = 2:512 
    freqAxis(k) = freqAxis(k-1) * 10^((log10(f_temp))/(512-1)); 
end  

% Olive
olive = [ 5.10  5.05  5.00  4.85 ... % 20
          4.90  5.00  5.10  5.15 ... % 30
          5.20  5.10  5.00  4.95 ... % 40
          4.90  4.87  4.85  4.83 ... % 50
          4.80  4.70  4.50  4.45 ... % 60
          4.40  4.25  4.10  4.05 ... % 70
          4.00  3.80  3.80  3.75 ... % 80
          3.70  3.70  3.55  3.52 ... % 90 
          3.50  2.65  1.60  1.20 ... % 100
          1.00  1.20  1.50  1.65 ... % 200
          1.80  2.20  2.50  2.50 ... % 300
          2.50  2.60  2.70  2.75 ... % 400
          2.80  2.90  2.95  2.98 ... % 500
          3.00  3.10  3.20  3.25 ... % 600
          3.30  3.42  3.55  3.62 ... % 700
          3.70  3.85  4.00  4.00 ... % 800
          4.00  4.02  4.05  4.08 ... % 900
          4.10  4.80  6.00  7.30 ... % 1000
          7.80  10.1  12.0  12.8 ... % 2000
          13.0  13.0  12.1  11.4 ... % 3000
          11.2  10.2  9.70  9.40 ... % 4000
          9.10  8.65  8.20  8.00 ... % 5000
          7.70  7.40  7.00  6.65 ... % 6000
          6.30  5.75  5.20  5.05 ... % 7000
          4.90  4.65  4.20  3.80 ... % 8000
          3.50  2.80  2.00  1.80 ... % 9000
          1.50  -3.2  -6.5  -12.3... % 10000
          -7.0];                     % 20000
      
olive_fit = interp1(freqPoints1,olive,freqAxis,'spline');

% Free field
free = zeros(1,51);
free(51) = 1.45;
for k=1:50
    free(51-k) = free(52-k)-0.0464;
end
free(free<0)=0;

free =  [  free                    ...
           1.35                    ... % 575
           1.25  1.20  1.15  1.12  ... % 600
           1.09  1.06  1.00  0.75  ... % 700
           0.50  0.30  0.20  0.10  ... % 800
           0    -0.15 -0.20 -0.25  ... % 900
          -0.3   1     3     6     ... % 1000
           6.5   6.5   6.7   7     ... % 2000
           8.3  10    11.3  12.5   ... % 3000
          13    13    12.6  11.4   ... % 4000
          11    10     8.5   7     ... % 5000
           6     4     2     0     ... % 6000
          -1    -1.8  -2.2  -2.5   ... % 7000
          -2.2  -1.8  -1.2  -0.7   ... % 8000
          -1    -1.2  -3    -2.6   ... % 9000
          -2.2   1     6     8     ... % 10000
           8     6     4     5     ... % 10000
           3     2                 ... % 10000
           0];                         % 20000
free_fit = interp1(freqPoints2,free,freqAxis,'spline');
       
% Diffuse field
diffuse = [ 0     0    0     0     ... % 20
            0     0    0     0     ... % 30
            0     0    0     0     ... % 40
            0     0.01 0.015 0.02  ... % 50
            0.025 0.03 0.035 0.04  ... % 60
            0.045 0.05 0.055 0.060 ... % 70
            0.065 0.07 0.075 0.08  ... % 80
            0.085 0.09 0.095 0.1   ... % 90 
            0.105 0.2  0.3   0.4   ... % 100
            0.5   0.7  0.9   1.1   ... % 200
            1.2   1.25 1.3   1.36  ... % 300
            1.5   1.65 1.76  1.8   ... % 400
            1.8   2.1  2.2   2.25  ... % 500
            2.3   2.35 2.45  2.48  ... % 600
            2.55  2.53 2.52  2.51  ... % 700
            2.5   2.5  2.5   2.4   ... % 800
            2.4   2.5  2.5   2.6   ... % 900
            2.6   3.2  3.6   4.0   ... % 1000
            4.5   5.3  5.9   6.8   ... % 2000
            7.7   8.5  9.3  10     ... % 3000
           10.4  10.7 10.6  10.3   ... % 4000
           10     9.3  9.0   8.4   ... % 5000
            8     7.4  7.2   7.0   ... % 6000
            6.8   6.6  6.3   6.1   ... % 7000
            5.9   5.7  5.5   5.2   ... % 8000
            5     4.7  4.4   4     ... % 9000
            3.6   2 1  0.4         ... % 10000
            0];                        % 20000
      
diffuse_fit = interp1(freqPoints1,diffuse,freqAxis,'spline');

figure(10);
semilogx(freqAxis,free_fit,'r--','LineWidth',2.5); hold on
semilogx(freqAxis,diffuse_fit,'g-.','LineWidth',2.5);
semilogx(freqAxis,olive_fit,'b','LineWidth',2.5);

grid off;
set(gca,'XTick',[10 30 100 300 1000 3000 10000]')
xlabel('Frequency (Hz)')
ylabel('Magnitude (dB)')
set(gca,'fontname','Times','fontsize',fontsize)
axis([20 20000 -15 15])
legend('Free field','Diffuse field','Olive et al.','Location','SouthWest')
%print('hp_target_resp','-dpdf')